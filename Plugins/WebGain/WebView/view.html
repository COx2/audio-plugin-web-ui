<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WebGain GUI</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 20px;
    }

    #output {
        margin-top: 20px;
    }
</style>
</head>
<body>

<h1>WebGain GUI</h1>

<!-- HTML element to display the message -->
<p>Gain Value: <span id="gainValueLabel">50</span></p>
<input type="range" min="0" max="100" value="50" id="gainSlider">

<p>Invert Phase Value: <span id="invertPhaseValueLabel"></span></p>
<input type="checkbox" id="toggleInvertPhase">

<p>MessageBox: <span id="invertPhaseValueLabel"></span></p>
<div id="messageBox"></div>

<script>
    // Utility functions.
    function mapRange(value, fromMin, fromMax, toMin, toMax) {
        const clampedValue = Math.min(Math.max(value, fromMin), fromMax);
        const normalizedValue = (clampedValue - fromMin) / (fromMax - fromMin);
        const mappedValue = normalizedValue * (toMax - toMin) + toMin;
        return mappedValue;
    }

    // JavaScript code for handling button and slider events
    const gainSlider = document.getElementById('gainSlider');
    const gainValueLabel = document.getElementById('gainValueLabel');

    const toggleInvertPhase = document.getElementById('toggleInvertPhase');
    const invertPhaseValueLabel = document.getElementById('invertPhaseValueLabel');

    // Event listener for gain slider
    gainSlider.addEventListener('input', function() {
        const jsonData = {
            sliderName: gainSlider.id,
            sliderValue: gainSlider.value,
            sliderRangeMin: gainSlider.min,
            sliderRangeMax: gainSlider.max
        };
        
        gainValueLabel.innerText = gainSlider.value;

        onSliderChanged(jsonData)
    });

    // Event listener for toggle invert phase
    toggleInvertPhase.addEventListener('change', function() {
        const jsonData = {
            toggleName: toggleInvertPhase.id,
            toggleValue: toggleInvertPhase.checked,
        };
        
        invertPhaseValueLabel.innerText = toggleInvertPhase.checked;

        onToggleChanged(jsonData)
    });

    // Event callback from C++
    function onParameterChanged(jsonData){
        // This is the function that will be called from C++
        console.log('JSON from C++: ', jsonData);

        // Access the 'type' property in the JSON data
        const parameterName = jsonData.parameterName;
        
        // Update the HTML label with the message
        if(parameterName === "gain")
        {
            const mapped_value = mapRange(jsonData.parameterValue, 0.0, 1.0, gainSlider.min, gainSlider.max)
            console.log('gainSlider: ', mapped_value);
            
            gainSlider.value = mapped_value;
            gainValueLabel.innerText = gainSlider.value;
        }
        else if(parameterName === "invertPhase")
        {
            console.log('invertPhase: ', jsonData.parameterValue);

            toggleInvertPhase.checked = jsonData.parameterValue;
            invertPhaseValueLabel.innerText = toggleInvertPhase.checked;
        }
    }

    // JavaScript code defining the Hello function
    function Hello() {
        // This is the function that will be called from C++
        console.log('Hello from JavaScript!');
        
        // You can perform other actions or return data as needed
    }

    // JavaScript code defining the Hello function
    function HelloWithJson(jsonData) {
        // This is the function that will be called from C++
        console.log('HelloWithJson: ', jsonData);
        
        // Access the 'message' property in the JSON data
        var message = jsonData.message;

        // Update the HTML label with the message
        document.getElementById('messageBox').innerText = 'Message from C++: ' + message;

        // You can perform other actions or return data as needed
    }

    // Invoke C++ callback for requesting initial update.
    onInitialUpdate();
    </script>

</body>
</html>
